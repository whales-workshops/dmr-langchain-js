name: Bootstrap repository

on:
  push:
    branches: [ main ]
  create:

permissions:
  contents: write

jobs:
  bootstrap:
    name: Bootstrap repo
    if: github.repository != 'dockersamples/labspace-starter'
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Update compose.override.yaml
        run: |
          sed -i 's/\${REPO_OWNER}/${{ github.repository_owner }}/g' .labspace/compose.override.yaml
          sed -i 's/\${REPO_NAME}/${{ github.event.repository.name }}/g' .labspace/compose.override.yaml

      - name: Remove workflow file
        run: |
          rm .github/workflows/bootstrap-repo.yaml

      - name: Commit and push changes
        run: |
          git config --global user.name "${{ github.actor }}"
          git config --global user.email "${{ github.actor }}@users.noreply.github.com"      
          git add .
          git commit -m 'Bootstrap repository'
          git push